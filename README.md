# Aide for Profiling

A straighforward profiler to quickly profile your code in PHP.

## Installation

### Composer

~~~
composer require bakame-php/aide-profiler
~~~

### System Requirements

You need:

- **PHP >= 8.1** but the latest stable version of PHP is recommended

## Usage

Traditionally, you will use `microtime` to quickly profile your snippet.

The `Bakame\Aide\Profiler` package is an utility class that helps you remove the burden
of calculating and setting up your code for profiling.

The `Bakame\Aide\Error\Cloak` utility class helps you remove that burden by doing the heavy-lifting for you.

```php
<?php

use Bakame\Aide\Profiler\Profiler;

$callable = function (int ...$args): int|float => {
    usleep(100)
    
    return array_sum($args);
}; 

$profiler = new Profiler($callable);
$result = $profiler(1, 2, 3);
$result // wil be equal to 6;
$profile = $profiler->lastProfile(); // returns the last Profile object from the last call

$profile->executionTime(); //returns the execution time (the resutl of microtime
$profile->cpuTime(); 
$profile->memoryUsage();
$profile->peakMemoryUsage();
````

If you have `Symfony\console` installed in your application you can generate a table with a summary of everything profiles
generated by the profiler

```php
<?php

use Bakame\Aide\Profiler\Profiler;
use Bakame\Aide\Profiler\SimpleCliRenderer;

$callable = function (int ...$args): int|float => {
    usleep(100)
    
    return array_sum($args);
}; 

$profiler = new Profiler($callable);
$profiler->runWithLabel('first_run', 1, 2);
$profiler->runWithLabel('last_run', 1, 2);
$profiler(1, 2);

$renderer = new SimpleCliRenderer();
$renderer->render($profiler);
```

```bash
+--------------+--------------+---------------+-------------+---------------+---------------+----------------+
| Label        | CPU Time (s) | Exec Time (s) | Memory (kB) | Real Mem (kB) | Peak Mem (kB) | Real Peak (kB) |
+--------------+--------------+---------------+-------------+---------------+---------------+----------------+
| first_run    | 0.000094     | 0.001270      | 2.5         | 0.0           | 0.0           | 0.0            |
| last_run     | 0.000009     | 0.001259      | 2.5         | 0.0           | 0.0           | 0.0            |
| 2dc8fd3a8c5e | 0.000009     | 0.001260      | 2.5         | 0.0           | 0.0           | 0.0            |
+--------------+--------------+---------------+-------------+---------------+---------------+----------------+
```

You can attach a specific `label` to each profile using the `runWithLabel` method otherwise a unique label will
be generated for you.

## Testing

The library has:

- a [PHPUnit](https://phpunit.de) test suite.
- a coding style compliance test suite using [PHP CS Fixer](https://cs.symfony.com/).
- a code analysis compliance test suite using [PHPStan](https://github.com/phpstan/phpstan).

To run the tests, run the following command from the project folder.

```bash
composer test
```

## Contributing

Contributions are welcome and will be fully credited. Please see [CONTRIBUTING](.github/CONTRIBUTING.md) and [CONDUCT](.github/CODE_OF_CONDUCT.md) for details.

## Security

If you discover any security related issues, please email nyamsprod@gmail.com instead of using the issue tracker.

## Changelog

Please see [CHANGELOG](CHANGELOG.md) for more information on what has changed recently.


## Credits

- [ignace nyamagana butera](https://github.com/nyamsprod)
- [All Contributors](https://github.com/bakame-php/aide/graphs/contributors)